<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" TITLE="Style" href="../../../../../stylesheet.css">
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td class="bannercell" rowspan="2"><a href="http://phing.info/"><img src="http://phing.info/images/phing.gif" alt="http://phing.info/" align="left" border="0"></a></td>
<td style="text-align:right"><h2>Source Code Coverage</h2></td>
</tr>
<tr><td style="text-align:right">Designed for use with <a href="http://pear.php.net/package/PHPUnit2">PHPUnit2</a>, <a href="http://www.xdebug.org/">Xdebug</a> and <a href="http://phing.info/">Phing</a>.</td></tr>
</table>
<hr size="1">
<table class="log" cellpadding="5" cellspacing="0" width="100%"><tr class="a">
<td class="small">Methods: 21</td>
<td class="small">LOC: 793</td>
<td class="small">Statements: 0</td>
</tr></table>
<table class="log" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="legendItem" width="0%">Legend:</td>
<td class="legendValue" width="100%">
<span class="legendCovered">executed</span><span class="legendUncovered">not executed</span><span class="legendDeadCode">dead code</span>
</td>
</tr></tbody></table>
<table class="log" cellpadding="5" cellspacing="0" width="100%">
<tr>
<th width="100%">Source file</th>
<th>Statements</th>
<th>Methods</th>
<th width="250" colspan="2" nowrap>Total coverage</th>
</tr>
<tr class="a">
<td>MSSQLDialect.php</td>
<td>-</td>
<td>0.0%</td>
<td>0.0%</td>
<td><table cellspacing="0" cellpadding="0" border="0" width="100%" style="display: inline"><tr><td class="uncovered" width="200" height="12">Â </td></tr></table></td>
</tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%">
<tr>
<td class="lineCount">1</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">&lt;?php</pre></td>
</tr>
<tr>
<td class="lineCount">2</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">3</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * AgilePHP Framework :: The Rapid "for developers" PHP5 framework</pre></td>
</tr>
<tr>
<td class="lineCount">4</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * Copyright (C) 2009-2010 Make A Byte, inc</pre></td>
</tr>
<tr>
<td class="lineCount">5</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">6</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * This program is free software: you can redistribute it and/or modify</pre></td>
</tr>
<tr>
<td class="lineCount">7</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * it under the terms of the GNU General Public License as published by</pre></td>
</tr>
<tr>
<td class="lineCount">8</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * the Free Software Foundation, either version 3 of the License, or</pre></td>
</tr>
<tr>
<td class="lineCount">9</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * (at your option) any later version.</pre></td>
</tr>
<tr>
<td class="lineCount">10</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">11</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * This program is distributed in the hope that it will be useful,</pre></td>
</tr>
<tr>
<td class="lineCount">12</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</pre></td>
</tr>
<tr>
<td class="lineCount">13</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</pre></td>
</tr>
<tr>
<td class="lineCount">14</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * GNU General Public License for more details.</pre></td>
</tr>
<tr>
<td class="lineCount">15</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">16</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * You should have received a copy of the GNU General Public License</pre></td>
</tr>
<tr>
<td class="lineCount">17</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</pre></td>
</tr>
<tr>
<td class="lineCount">18</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">19</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @package com.makeabyte.agilephp.orm.dialect</pre></td>
</tr>
<tr>
<td class="lineCount">20</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCount">21</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">22</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">23</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * Responsible for MSSQL specific database operations.</pre></td>
</tr>
<tr>
<td class="lineCount">24</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * NOTE: This class uses the "Microsft SQL Server Driver for PHP".</pre></td>
</tr>
<tr>
<td class="lineCount">25</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">26</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @author Jeremy Hahn</pre></td>
</tr>
<tr>
<td class="lineCount">27</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @copyright Make A Byte, inc</pre></td>
</tr>
<tr>
<td class="lineCount">28</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @package com.makeabyte.agilephp.orm.dialect</pre></td>
</tr>
<tr>
<td class="lineCount">29</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCount">30</td>
<td class="coverageCount"></td>
<td class="srcLineClassStart"><pre class="srcLine">final class MSSQLDialect extends BaseDialect implements SQLDialect {</pre></td>
</tr>
<tr>
<td class="lineCount">31</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">32</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  private $conn;</pre></td>
</tr>
<tr>
<td class="lineCount">33</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  private $stmt;</pre></td>
</tr>
<tr>
<td class="lineCount">34</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  private $statement;</pre></td>
</tr>
<tr>
<td class="lineCount">35</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  private $connectFlag = -1;</pre></td>
</tr>
<tr>
<td class="lineCount">36</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">37</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">38</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   *  Initalize MSSQLDialect.</pre></td>
</tr>
<tr>
<td class="lineCount">39</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   *</pre></td>
</tr>
<tr>
<td class="lineCount">40</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @param Database $db The Database object representing orm.xml</pre></td>
</tr>
<tr>
<td class="lineCount">41</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @return void</pre></td>
</tr>
<tr>
<td class="lineCount">42</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">43</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   public function __construct( Database $db ) {</pre></td>
</tr>
<tr>
<td class="lineCount">44</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">45</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   		  if( !function_exists( 'sqlsrv_connect' ) )</pre></td>
</tr>
<tr>
<td class="lineCount">46</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   		  	  throw new ORMException( 'Microsoft SQL Server Driver for PHP is not installed on the server.' );</pre></td>
</tr>
<tr>
<td class="lineCount">47</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">48</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   		  $params = array( 'Database' =&gt; $db-&gt;getName(), 'UID' =&gt; $db-&gt;getUsername(), 'PWD' =&gt; $db-&gt;getPassword() );</pre></td>
</tr>
<tr>
<td class="lineCount">49</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   		  $noDbParams = array( 'UID' =&gt; $db-&gt;getUsername(), 'PWD' =&gt; $db-&gt;getPassword() );</pre></td>
</tr>
<tr>
<td class="lineCount">50</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">51</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  	      if( !$this-&gt;conn = sqlsrv_connect( $db-&gt;getHostname(), $params ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">52</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">53</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  	      	  $this-&gt;connectFlag = 0;</pre></td>
</tr>
<tr>
<td class="lineCount">54</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 	  if( !$this-&gt;conn = sqlsrv_connect( $db-&gt;getHostname(), $noDbParams ) ) { // Create statement needs to bind to server</pre></td>
</tr>
<tr>
<td class="lineCount">55</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">56</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 	  	  $this-&gt;connectFlag = -1;</pre></td>
</tr>
<tr>
<td class="lineCount">57</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 	  	  throw new ORMException( print_r( sqlsrv_errors(), true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">58</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 	  }</pre></td>
</tr>
<tr>
<td class="lineCount">59</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  	      }</pre></td>
</tr>
<tr>
<td class="lineCount">60</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">61</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  	      $this-&gt;connectFlag = 1;</pre></td>
</tr>
<tr>
<td class="lineCount">62</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 	      $this-&gt;database = $db;</pre></td>
</tr>
<tr>
<td class="lineCount">63</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">64</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">65</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">66</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">67</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/dialect/SQLDialect#isConnected()</pre></td>
</tr>
<tr>
<td class="lineCount">68</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">69</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function isConnected() {</pre></td>
</tr>
<tr>
<td class="lineCount">70</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">71</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 return $this-&gt;connectFlag;</pre></td>
</tr>
<tr>
<td class="lineCount">72</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">73</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">74</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function call( $model ) {</pre></td>
</tr>
<tr>
<td class="lineCount">75</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">76</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $values = array();</pre></td>
</tr>
<tr>
<td class="lineCount">77</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $outs = array();</pre></td>
</tr>
<tr>
<td class="lineCount">78</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $params = array();</pre></td>
</tr>
<tr>
<td class="lineCount">79</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $class = get_class( $model );</pre></td>
</tr>
<tr>
<td class="lineCount">80</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $proc = $this-&gt;getProcedureByModel( $model );</pre></td>
</tr>
<tr>
<td class="lineCount">81</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">82</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 foreach( $proc-&gt;getParameters() as $param ) {</pre></td>
</tr>
<tr>
<td class="lineCount">83</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">84</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 		  if( $param-&gt;getMode() == 'IN' || $param-&gt;getMode() == 'INOUT' ) {</pre></td>
</tr>
<tr>
<td class="lineCount">85</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">86</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 			  $accessor = $this-&gt;toAccessor( $param-&gt;getModelPropertyName() );</pre></td>
</tr>
<tr>
<td class="lineCount">87</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 			  array_push( $params, $model-&gt;$accessor() );</pre></td>
</tr>
<tr>
<td class="lineCount">88</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 		  }</pre></td>
</tr>
<tr>
<td class="lineCount">89</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">90</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 		  if( $param-&gt;getMode() == 'OUT' || $param-&gt;getMode() == 'INOUT' )</pre></td>
</tr>
<tr>
<td class="lineCount">91</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 			  $outs[$param-&gt;getName()] = $param-&gt;getModelPropertyName();</pre></td>
</tr>
<tr>
<td class="lineCount">92</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 }</pre></td>
</tr>
<tr>
<td class="lineCount">93</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">94</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $query = '{call ' . $proc-&gt;getName() . ' ( ';</pre></td>
</tr>
<tr>
<td class="lineCount">95</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 for( $i=0; $i&lt;count( $params ); $i++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">96</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">97</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 		$values[$i] = $params[$i];</pre></td>
</tr>
<tr>
<td class="lineCount">98</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 		$query .= '?' . (($i+1) == count($query) ? ', ' : '' );</pre></td>
</tr>
<tr>
<td class="lineCount">99</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 }</pre></td>
</tr>
<tr>
<td class="lineCount">100</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $query .= ' ) }';</pre></td>
</tr>
<tr>
<td class="lineCount">101</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">102</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $models = array();</pre></td>
</tr>
<tr>
<td class="lineCount">103</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $params = array_merge( $params, $outs );</pre></td>
</tr>
<tr>
<td class="lineCount">104</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">105</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 Log::debug( 'MSSQLDialect::call ' . $query . ' with params ' . print_r( $params, true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">106</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">107</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $stmt = sqlsrv_query( $this-&gt;conn, $query, array_merge( $params, $outs ) );</pre></td>
</tr>
<tr>
<td class="lineCount">108</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 while( $record = sqlsrv_fetch_array( $stmt, SQLSRV_FETCH_ASSOC ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">109</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">110</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 		$m = new $class;</pre></td>
</tr>
<tr>
<td class="lineCount">111</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		 		 	foreach( $record as $column =&gt; $value ) {</pre></td>
</tr>
<tr>
<td class="lineCount">112</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">113</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		 		 			 if( $value instanceof DateTime )</pre></td>
</tr>
<tr>
<td class="lineCount">114</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		 		 			 	 $value = $value-&gt;date;</pre></td>
</tr>
<tr>
<td class="lineCount">115</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">116</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		 		 	 		 $mutator = $this-&gt;toMutator( $outs[$column] );</pre></td>
</tr>
<tr>
<td class="lineCount">117</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		  		 		  	 $m-&gt;$mutator( $value );</pre></td>
</tr>
<tr>
<td class="lineCount">118</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		 		    }</pre></td>
</tr>
<tr>
<td class="lineCount">119</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		 		 	array_push( $models, $m );</pre></td>
</tr>
<tr>
<td class="lineCount">120</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 }</pre></td>
</tr>
<tr>
<td class="lineCount">121</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">122</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 return (count( $models ) == 1) ? $models[0] : $models;</pre></td>
</tr>
<tr>
<td class="lineCount">123</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">124</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">125</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">126</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">127</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/dialect/SQLDialect#create()</pre></td>
</tr>
<tr>
<td class="lineCount">128</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">129</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function create() {</pre></td>
</tr>
<tr>
<td class="lineCount">130</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">131</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $this-&gt;query( 'CREATE DATABASE ' . $this-&gt;database-&gt;getName() . ';' );</pre></td>
</tr>
<tr>
<td class="lineCount">132</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">133</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 // Close the connection to the server and bind to the new database.</pre></td>
</tr>
<tr>
<td class="lineCount">134</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $this-&gt;close();</pre></td>
</tr>
<tr>
<td class="lineCount">135</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $params = array( 'Database' =&gt; $this-&gt;database-&gt;getName(), 'UID' =&gt; $this-&gt;database-&gt;getUsername(), 'PWD' =&gt; $this-&gt;database-&gt;getPassword() );</pre></td>
</tr>
<tr>
<td class="lineCount">136</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 if( !$this-&gt;conn = sqlsrv_connect( $this-&gt;database-&gt;getHostname(), $params ) )</pre></td>
</tr>
<tr>
<td class="lineCount">137</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 	 throw new ORMException( print_r( sqlsrv_errors(), true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">138</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">139</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $constraintFails = array();</pre></td>
</tr>
<tr>
<td class="lineCount">140</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">141</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 foreach( $this-&gt;database-&gt;getTables() as $table ) {</pre></td>
</tr>
<tr>
<td class="lineCount">142</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">143</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                  $sql = $this-&gt;toCreateTableSQL( $table );</pre></td>
</tr>
<tr>
<td class="lineCount">144</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                  if( !$this-&gt;query( $sql ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">145</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">146</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                          $error = sqlsrv_errors();</pre></td>
</tr>
<tr>
<td class="lineCount">147</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">148</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                          // This saves the create operation from blowing up if orm.xml defines a table</pre></td>
</tr>
<tr>
<td class="lineCount">149</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                          // that references a table further down the orm.xml file that has not been</pre></td>
</tr>
<tr>
<td class="lineCount">150</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                          // created yet. Is there a cleaner way - like disabling constraint checks?</pre></td>
</tr>
<tr>
<td class="lineCount">151</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                          if( stristr( $error[0]['message'], 'references invalid table' ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">152</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">153</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                                  array_push( $constraintFails, $sql );</pre></td>
</tr>
<tr>
<td class="lineCount">154</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                                  continue;</pre></td>
</tr>
<tr>
<td class="lineCount">155</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                          }</pre></td>
</tr>
<tr>
<td class="lineCount">156</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">157</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                          throw new ORMException( print_r( sqlsrv_errors(), true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">158</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                  }</pre></td>
</tr>
<tr>
<td class="lineCount">159</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 }</pre></td>
</tr>
<tr>
<td class="lineCount">160</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">161</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 // Constraint hack continued</pre></td>
</tr>
<tr>
<td class="lineCount">162</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 if( count( $constraintFails ) )</pre></td>
</tr>
<tr>
<td class="lineCount">163</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 	 foreach( $constraintFails as $sql )</pre></td>
</tr>
<tr>
<td class="lineCount">164</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 	 		if( !$this-&gt;query( $sql ) )</pre></td>
</tr>
<tr>
<td class="lineCount">165</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		  		 	 		throw new ORMException( print_r( sqlsrv_errors(), true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">166</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">167</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">168</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">169</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">170</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/dialect/SQLDialect#createTable(Table $table)</pre></td>
</tr>
<tr>
<td class="lineCount">171</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">172</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">      public function createTable( Table $table ) {</pre></td>
</tr>
<tr>
<td class="lineCount">173</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">174</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              $this-&gt;query( $this-&gt;toCreateTableSQL( $table ) );</pre></td>
</tr>
<tr>
<td class="lineCount">175</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">      }</pre></td>
</tr>
<tr>
<td class="lineCount">176</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">177</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">      /**</pre></td>
</tr>
<tr>
<td class="lineCount">178</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">179</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/dialect/SQLDialect#dropTable(Table $table)</pre></td>
</tr>
<tr>
<td class="lineCount">180</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">181</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">      public function dropTable( Table $table ) {</pre></td>
</tr>
<tr>
<td class="lineCount">182</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">183</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             $this-&gt;query( 'DROP TABLE ' . $table-&gt;getName() );</pre></td>
</tr>
<tr>
<td class="lineCount">184</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">      }</pre></td>
</tr>
<tr>
<td class="lineCount">185</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">186</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">      /**</pre></td>
</tr>
<tr>
<td class="lineCount">187</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">       * Returns SQL CREATE TABLE statement for the specified table</pre></td>
</tr>
<tr>
<td class="lineCount">188</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">       *</pre></td>
</tr>
<tr>
<td class="lineCount">189</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">       * @param Table $table The table to create the SQL code for</pre></td>
</tr>
<tr>
<td class="lineCount">190</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">       * @return string The SQL CREATE TABLE statement</pre></td>
</tr>
<tr>
<td class="lineCount">191</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">       */</pre></td>
</tr>
<tr>
<td class="lineCount">192</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">      private function toCreateTableSQL( Table $table ) {</pre></td>
</tr>
<tr>
<td class="lineCount">193</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">194</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              $sql = 'CREATE TABLE ' . $table-&gt;getName() . ' ( ';</pre></td>
</tr>
<tr>
<td class="lineCount">195</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">196</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              foreach( $table-&gt;getColumns() as $column ) {</pre></td>
</tr>
<tr>
<td class="lineCount">197</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">198</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                       $sql .= '[' . $column-&gt;getName() . '] ' . $column-&gt;getType() .</pre></td>
</tr>
<tr>
<td class="lineCount">199</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                 (($column-&gt;getLength()) ? '(' . $column-&gt;getLength() . ')' : '') .</pre></td>
</tr>
<tr>
<td class="lineCount">200</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                 (($column-&gt;isRequired() == true) ? ' NOT NULL' : '') .</pre></td>
</tr>
<tr>
<td class="lineCount">201</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                 (($column-&gt;isAutoIncrement() === true) ? ' IDENTITY(1,1)' : '') .</pre></td>
</tr>
<tr>
<td class="lineCount">202</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                 (($column-&gt;getDefault() &amp;&amp; $column-&gt;getType() != 'datetime' &amp;&amp;</pre></td>
</tr>
<tr>
<td class="lineCount">203</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                     $column-&gt;getType() != 'timestamp' &amp;&amp; !$column-&gt;isAutoIncrement() &amp;&amp;</pre></td>
</tr>
<tr>
<td class="lineCount">204</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                     !$column-&gt;isPrimaryKey()) ? ' DEFAULT ' . $column-&gt;getDefault() : '') .</pre></td>
</tr>
<tr>
<td class="lineCount">205</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                 ((!$column-&gt;getDefault() &amp;&amp; !$column-&gt;isRequired() &amp;&amp; !$column-&gt;isAutoIncrement() &amp;&amp;</pre></td>
</tr>
<tr>
<td class="lineCount">206</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                      !$column-&gt;isPrimaryKey()) ? ' DEFAULT NULL' : '') . ', ';</pre></td>
</tr>
<tr>
<td class="lineCount">207</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              }</pre></td>
</tr>
<tr>
<td class="lineCount">208</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">209</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              $pkeyColumns = $table-&gt;getPrimaryKeyColumns();</pre></td>
</tr>
<tr>
<td class="lineCount">210</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              if( count( $pkeyColumns ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">211</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">212</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                  $sql .= ' PRIMARY KEY ( ';</pre></td>
</tr>
<tr>
<td class="lineCount">213</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                  for( $i=0; $i&lt;count( $pkeyColumns ); $i++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">214</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">215</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                       $sql .= '[' . $pkeyColumns[$i]-&gt;getName() . ']';</pre></td>
</tr>
<tr>
<td class="lineCount">216</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">217</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                       if( ($i+1) &lt; count( $pkeyColumns ) )</pre></td>
</tr>
<tr>
<td class="lineCount">218</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                           $sql .= ', ';</pre></td>
</tr>
<tr>
<td class="lineCount">219</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                  }</pre></td>
</tr>
<tr>
<td class="lineCount">220</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	              $sql .= ' ), ';</pre></td>
</tr>
<tr>
<td class="lineCount">221</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              }</pre></td>
</tr>
<tr>
<td class="lineCount">222</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">223</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              if( $table-&gt;hasForeignKey() ) {</pre></td>
</tr>
<tr>
<td class="lineCount">224</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">225</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                  $bProcessedKeys = array();</pre></td>
</tr>
<tr>
<td class="lineCount">226</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                  $foreignKeyColumns = $table-&gt;getForeignKeyColumns();</pre></td>
</tr>
<tr>
<td class="lineCount">227</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                  for( $h=0; $h&lt;count( $foreignKeyColumns ); $h++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">228</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">229</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $fk = $foreignKeyColumns[$h]-&gt;getForeignKey();</pre></td>
</tr>
<tr>
<td class="lineCount">230</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">231</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        if( in_array( $fk-&gt;getName(), $bProcessedKeys ) )</pre></td>
</tr>
<tr>
<td class="lineCount">232</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                            continue;</pre></td>
</tr>
<tr>
<td class="lineCount">233</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">234</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $fk-&gt;setOnUpdate( str_replace( '_', ' ', $fk-&gt;getOnUpdate() ) );</pre></td>
</tr>
<tr>
<td class="lineCount">235</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $fk-&gt;setOnDelete( str_replace( '_', ' ', $fk-&gt;getOnDelete() ) );</pre></td>
</tr>
<tr>
<td class="lineCount">236</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">237</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        // Get foreign keys which are part of the same relationship</pre></td>
</tr>
<tr>
<td class="lineCount">238</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $relatedKeys = $table-&gt;getForeignKeyColumnsByKey( $fk-&gt;getName() );</pre></td>
</tr>
<tr>
<td class="lineCount">239</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">240</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $sql .= ' CONSTRAINT ' . $fk-&gt;getName() . '';</pre></td>
</tr>
<tr>
<td class="lineCount">241</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $sql .= ' FOREIGN KEY ( ';</pre></td>
</tr>
<tr>
<td class="lineCount">242</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">243</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        for( $j=0; $j&lt;count( $relatedKeys ); $j++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">244</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">245</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                             $sql .= $relatedKeys[$j]-&gt;getColumnInstance()-&gt;getName();</pre></td>
</tr>
<tr>
<td class="lineCount">246</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                             if( ($j+1) &lt; count( $relatedKeys ) )</pre></td>
</tr>
<tr>
<td class="lineCount">247</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                 $sql .= ', ';</pre></td>
</tr>
<tr>
<td class="lineCount">248</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        }</pre></td>
</tr>
<tr>
<td class="lineCount">249</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">250</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $sql .= ' ) REFERENCES ' . $fk-&gt;getReferencedTable() . ' ( ';</pre></td>
</tr>
<tr>
<td class="lineCount">251</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">252</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        for( $j=0; $j&lt;count( $relatedKeys ); $j++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">253</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">254</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                             $sql .= '' . $relatedKeys[$j]-&gt;getReferencedColumn() . '';</pre></td>
</tr>
<tr>
<td class="lineCount">255</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                             if( ($j+1) &lt; count( $relatedKeys ) )</pre></td>
</tr>
<tr>
<td class="lineCount">256</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                                 $sql .= ', ';</pre></td>
</tr>
<tr>
<td class="lineCount">257</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        }</pre></td>
</tr>
<tr>
<td class="lineCount">258</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">259</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $sql .= ' ) ';</pre></td>
</tr>
<tr>
<td class="lineCount">260</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $sql .= (($fk-&gt;getOnUpdate()) ? ' ON UPDATE ' . $fk-&gt;getOnUpdate() : '' );</pre></td>
</tr>
<tr>
<td class="lineCount">261</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        $sql .= (($fk-&gt;getOnDelete()) ? ' ON DELETE ' . $fk-&gt;getOnDelete() : '' ) . ', ';</pre></td>
</tr>
<tr>
<td class="lineCount">262</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">263</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                        array_push( $bProcessedKeys, $fk-&gt;getName() );</pre></td>
</tr>
<tr>
<td class="lineCount">264</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">                   }</pre></td>
</tr>
<tr>
<td class="lineCount">265</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              }</pre></td>
</tr>
<tr>
<td class="lineCount">266</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">267</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              $sql .= ');';</pre></td>
</tr>
<tr>
<td class="lineCount">268</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">269</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">              return $sql;</pre></td>
</tr>
<tr>
<td class="lineCount">270</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">          }</pre></td>
</tr>
<tr>
<td class="lineCount">271</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">272</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">273</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">274</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/AgilePHP/orm/BaseDialect#beginTransaction()</pre></td>
</tr>
<tr>
<td class="lineCount">275</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">276</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function beginTransaction() {</pre></td>
</tr>
<tr>
<td class="lineCount">277</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">278</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 Log::debug( 'MSSQLDialect::beginTransaction Beginning transaction' );</pre></td>
</tr>
<tr>
<td class="lineCount">279</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">280</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">281</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">282</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">283</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/AgilePHP/orm/BaseDialect#commit()</pre></td>
</tr>
<tr>
<td class="lineCount">284</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">285</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function commit() {</pre></td>
</tr>
<tr>
<td class="lineCount">286</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">287</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 sqlsrv_commit( $this-&gt;conn );</pre></td>
</tr>
<tr>
<td class="lineCount">288</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">289</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 Log::debug( 'MSSQLDialect::commit Transaction successfully committed.' );</pre></td>
</tr>
<tr>
<td class="lineCount">290</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">291</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">292</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">293</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">294</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/AgilePHP/orm/BaseDialect#rollBack($message, $code)</pre></td>
</tr>
<tr>
<td class="lineCount">295</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">296</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function rollBack( $message = null, $code = 0 ) {</pre></td>
</tr>
<tr>
<td class="lineCount">297</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">298</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 Log::debug( 'MSSQLDialect::rollBack ' . (($message == null) ? '' : ' ' . $message ) );</pre></td>
</tr>
<tr>
<td class="lineCount">299</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">300</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $this-&gt;transactionInProgress = false;</pre></td>
</tr>
<tr>
<td class="lineCount">301</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 sqlsrv_rollback( $this-&gt;conn );</pre></td>
</tr>
<tr>
<td class="lineCount">302</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">303</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 if( $message ) throw new ORMException( $message, $code );</pre></td>
</tr>
<tr>
<td class="lineCount">304</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">305</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">306</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">307</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * A statement resource. If the statement cannot be created and/or executed, false is returned.</pre></td>
</tr>
<tr>
<td class="lineCount">308</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   *</pre></td>
</tr>
<tr>
<td class="lineCount">309</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @param String $sql The SQL statement to execute</pre></td>
</tr>
<tr>
<td class="lineCount">310</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @param array $params Optional array of values that correspond to parameters in a parameterized query.</pre></td>
</tr>
<tr>
<td class="lineCount">311</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @return A statement resource. If the statement cannot be created and/or executed, false is returned.</pre></td>
</tr>
<tr>
<td class="lineCount">312</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/AgilePHP/orm/BaseDialect#query($sql)</pre></td>
</tr>
<tr>
<td class="lineCount">313</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">314</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function query( $sql, $params = array() ) {</pre></td>
</tr>
<tr>
<td class="lineCount">315</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">316</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 Log::debug( 'MSSQLDialect::query Executing' .</pre></td>
</tr>
<tr>
<td class="lineCount">317</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			  	     					(($this-&gt;transactionInProgress) ? ' (transactional) ' : ' ') .</pre></td>
</tr>
<tr>
<td class="lineCount">318</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			  	     					'raw PDO::query ' . $sql . 'with $params ' . print_r( $params, true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">319</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">320</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 return sqlsrv_query( $this-&gt;conn, $sql, (count( $params )) ? $params : null );</pre></td>
</tr>
<tr>
<td class="lineCount">321</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">322</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">323</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">324</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">325</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/BaseDialect#prepare($statement)</pre></td>
</tr>
<tr>
<td class="lineCount">326</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">327</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function prepare( $statement ) {</pre></td>
</tr>
<tr>
<td class="lineCount">328</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">329</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 Log::debug( 'MSSQLDialect::prepare Preparing' .</pre></td>
</tr>
<tr>
<td class="lineCount">330</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			  	     					(($this-&gt;transactionInProgress) ? ' (transactional) ' : ' ') .</pre></td>
</tr>
<tr>
<td class="lineCount">331</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			  	     					'statement ' . $statement );</pre></td>
</tr>
<tr>
<td class="lineCount">332</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">333</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $this-&gt;statement = $statement;</pre></td>
</tr>
<tr>
<td class="lineCount">334</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">335</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">336</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">337</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">338</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/BaseDialect#execute($inputParameters)</pre></td>
</tr>
<tr>
<td class="lineCount">339</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">340</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function execute( array $inputParameters = array() ) {</pre></td>
</tr>
<tr>
<td class="lineCount">341</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">342</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 Log::debug( 'MSSQLDialect::execute Executing' .</pre></td>
</tr>
<tr>
<td class="lineCount">343</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			  	     		(($this-&gt;transactionInProgress) ? ' (transactional) ' : ' ') .</pre></td>
</tr>
<tr>
<td class="lineCount">344</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			  	     		'prepared statement with inputParameters ' . print_r( $inputParameters, true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">345</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">346</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 // SQLSRV driver requires parameters passed to prepare be passed by reference</pre></td>
</tr>
<tr>
<td class="lineCount">347</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $params = array();</pre></td>
</tr>
<tr>
<td class="lineCount">348</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 for( $i=0; $i&lt;count( $inputParameters ); $i++ )</pre></td>
</tr>
<tr>
<td class="lineCount">349</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 	 $params[$i] = &amp;$inputParameters[$i];</pre></td>
</tr>
<tr>
<td class="lineCount">350</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">351</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 if( !$this-&gt;stmt = sqlsrv_prepare( $this-&gt;conn, $this-&gt;statement, $params ) )</pre></td>
</tr>
<tr>
<td class="lineCount">352</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 	 throw new ORMException( print_r( sqlsrv_errors(), true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">353</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">354</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 if( !sqlsrv_execute( $this-&gt;stmt ) )</pre></td>
</tr>
<tr>
<td class="lineCount">355</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 	 throw new ORMException( print_r( sqlsrv_errors(), true ) );</pre></td>
</tr>
<tr>
<td class="lineCount">356</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">357</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">358</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">359</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">360</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/BaseDialect#truncate($model)</pre></td>
</tr>
<tr>
<td class="lineCount">361</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">362</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function truncate( $model ) {</pre></td>
</tr>
<tr>
<td class="lineCount">363</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">364</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  	     $table = $this-&gt;getTableByModel( $model );</pre></td>
</tr>
<tr>
<td class="lineCount">365</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $this-&gt;query( 'TRUNCATE table ' . $table-&gt;getName() . ';' );</pre></td>
</tr>
<tr>
<td class="lineCount">366</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">367</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">368</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">369</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">370</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/dialect/SQLDialect#drop()</pre></td>
</tr>
<tr>
<td class="lineCount">371</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">372</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function drop() {</pre></td>
</tr>
<tr>
<td class="lineCount">373</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">374</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">  	 	 	 $this-&gt;query( 'DROP DATABASE ' . $this-&gt;getDatabase()-&gt;getName() );</pre></td>
</tr>
<tr>
<td class="lineCount">375</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">376</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">377</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  	/**</pre></td>
</tr>
<tr>
<td class="lineCount">378</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   	 * Persists a domain model object</pre></td>
</tr>
<tr>
<td class="lineCount">379</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	     *</pre></td>
</tr>
<tr>
<td class="lineCount">380</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	     * @param $model The domain model object to persist</pre></td>
</tr>
<tr>
<td class="lineCount">381</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	     * @return PDOStatement</pre></td>
</tr>
<tr>
<td class="lineCount">382</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	     * @throws ORMException</pre></td>
</tr>
<tr>
<td class="lineCount">383</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	     */</pre></td>
</tr>
<tr>
<td class="lineCount">384</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    public function persist( $model ) {</pre></td>
</tr>
<tr>
<td class="lineCount">385</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">386</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   $this-&gt;model = $model;</pre></td>
</tr>
<tr>
<td class="lineCount">387</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">388</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   		   $values = array();</pre></td>
</tr>
<tr>
<td class="lineCount">389</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   $table = $this-&gt;getTableByModel( $model );</pre></td>
</tr>
<tr>
<td class="lineCount">390</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">391</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   Log::debug( 'MSSQLDialect::persist Performing persist on model \'' . $table-&gt;getModel() . '\'.' );</pre></td>
</tr>
<tr>
<td class="lineCount">392</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">393</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   		   $this-&gt;validate( $table, true );</pre></td>
</tr>
<tr>
<td class="lineCount">394</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">395</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   $sql = 'INSERT INTO ' . $table-&gt;getName() . '( ';</pre></td>
</tr>
<tr>
<td class="lineCount">396</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">397</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   $cols = $table-&gt;getColumns();</pre></td>
</tr>
<tr>
<td class="lineCount">398</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">399</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   $columns = array();</pre></td>
</tr>
<tr>
<td class="lineCount">400</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   foreach( $cols as $column ) {</pre></td>
</tr>
<tr>
<td class="lineCount">401</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">402</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		if( $column-&gt;getType() == 'timestamp' ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">403</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		if( $column-&gt;isAutoIncrement() ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">404</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		if( $column-&gt;isLazy() ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">405</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">406</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		array_push( $columns, $column );</pre></td>
</tr>
<tr>
<td class="lineCount">407</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   }</pre></td>
</tr>
<tr>
<td class="lineCount">408</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">409</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   for( $i=0; $i&lt;count( $columns ); $i++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">410</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">411</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		$sql .= $columns[$i]-&gt;getName();</pre></td>
</tr>
<tr>
<td class="lineCount">412</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">413</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		if( ($i + 1) &lt; count( $columns ) )</pre></td>
</tr>
<tr>
<td class="lineCount">414</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   			$sql .= ', ';</pre></td>
</tr>
<tr>
<td class="lineCount">415</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   }</pre></td>
</tr>
<tr>
<td class="lineCount">416</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   $sql .= ' ) VALUES ( ';</pre></td>
</tr>
<tr>
<td class="lineCount">417</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   for( $i=0; $i&lt;count( $columns ); $i++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">418</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">419</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		$sql .= '?';</pre></td>
</tr>
<tr>
<td class="lineCount">420</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">421</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    $accessor = $this-&gt;toAccessor( $columns[$i]-&gt;getModelPropertyName() );</pre></td>
</tr>
<tr>
<td class="lineCount">422</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    if( $columns[$i]-&gt;isForeignKey() ) {</pre></td>
</tr>
<tr>
<td class="lineCount">423</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">424</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    	if( is_object( $model-&gt;$accessor() ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">425</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">426</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    		$refAccessor = $this-&gt;toAccessor( $columns[$i]-&gt;getForeignKey()-&gt;getReferencedColumnInstance()-&gt;getModelPropertyName() );</pre></td>
</tr>
<tr>
<td class="lineCount">427</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    		// Get foreign key value from the referenced field/instance accessor</pre></td>
</tr>
<tr>
<td class="lineCount">428</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    		if( $model-&gt;$accessor()-&gt;$refAccessor() != null ) {</pre></td>
</tr>
<tr>
<td class="lineCount">429</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">430</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    			try {</pre></td>
</tr>
<tr>
<td class="lineCount">431</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    				  // Try to persist the referenced entity first</pre></td>
</tr>
<tr>
<td class="lineCount">432</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					   	    		  $this-&gt;persist( $model-&gt;$accessor() );</pre></td>
</tr>
<tr>
<td class="lineCount">433</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					   	    		  array_push( $values, $model-&gt;$accessor()-&gt;$refAccessor() );</pre></td>
</tr>
<tr>
<td class="lineCount">434</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    			}</pre></td>
</tr>
<tr>
<td class="lineCount">435</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    			catch( Exception $e ) {</pre></td>
</tr>
<tr>
<td class="lineCount">436</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">437</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    				   // The referenced entity doesnt exist yet, persist it</pre></td>
</tr>
<tr>
<td class="lineCount">438</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    				   if( preg_match( '/duplicate/i', $e-&gt;getMessage() ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">439</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">440</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    				   	   $this-&gt;merge( $model-&gt;$accessor() );</pre></td>
</tr>
<tr>
<td class="lineCount">441</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    				   	   array_push( $values, $model-&gt;$accessor()-&gt;$refAccessor() );</pre></td>
</tr>
<tr>
<td class="lineCount">442</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    				   }</pre></td>
</tr>
<tr>
<td class="lineCount">443</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    			}</pre></td>
</tr>
<tr>
<td class="lineCount">444</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    		}</pre></td>
</tr>
<tr>
<td class="lineCount">445</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    	}</pre></td>
</tr>
<tr>
<td class="lineCount">446</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    	else {</pre></td>
</tr>
<tr>
<td class="lineCount">447</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">448</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    		array_push( $values, null );</pre></td>
</tr>
<tr>
<td class="lineCount">449</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    	}</pre></td>
</tr>
<tr>
<td class="lineCount">450</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    }</pre></td>
</tr>
<tr>
<td class="lineCount">451</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    else // No foreign key</pre></td>
</tr>
<tr>
<td class="lineCount">452</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   	    	array_push( $values, (($model-&gt;$accessor() == '') ? NULL : $model-&gt;$accessor()) );</pre></td>
</tr>
<tr>
<td class="lineCount">453</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">454</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   		if( ($i + 1) &lt; count( $columns ) )</pre></td>
</tr>
<tr>
<td class="lineCount">455</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				   		$sql .= ', ';</pre></td>
</tr>
<tr>
<td class="lineCount">456</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   }</pre></td>
</tr>
<tr>
<td class="lineCount">457</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			   $sql .= ' );';</pre></td>
</tr>
<tr>
<td class="lineCount">458</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">459</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   		   $this-&gt;prepare( $sql );</pre></td>
</tr>
<tr>
<td class="lineCount">460</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		   return $this-&gt;execute( $values );</pre></td>
</tr>
<tr>
<td class="lineCount">461</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    }</pre></td>
</tr>
<tr>
<td class="lineCount">462</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">463</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">464</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * Overrides parent find method to provide MSSQL specific syntax.</pre></td>
</tr>
<tr>
<td class="lineCount">465</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   *</pre></td>
</tr>
<tr>
<td class="lineCount">466</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @param $model A domain model object. Any fields which are set in the object are used to filter results.</pre></td>
</tr>
<tr>
<td class="lineCount">467</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @throws ORMException If any primary keys contain null values or any</pre></td>
</tr>
<tr>
<td class="lineCount">468</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * 		   errors are encountered executing queries</pre></td>
</tr>
<tr>
<td class="lineCount">469</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">470</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function find( $model ) {</pre></td>
</tr>
<tr>
<td class="lineCount">471</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">472</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	 $table = $this-&gt;getTableByModel( $model );</pre></td>
</tr>
<tr>
<td class="lineCount">473</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $newModel = $table-&gt;getModelInstance();</pre></td>
</tr>
<tr>
<td class="lineCount">474</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $values = array();</pre></td>
</tr>
<tr>
<td class="lineCount">475</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">476</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 Log::debug( 'MSSQLDialect::find Performing find on model \'' . $table-&gt;getModel() . '\'.' );</pre></td>
</tr>
<tr>
<td class="lineCount">477</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">478</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 try {</pre></td>
</tr>
<tr>
<td class="lineCount">479</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		  	    $pkeyColumns = $table-&gt;getPrimaryKeyColumns();</pre></td>
</tr>
<tr>
<td class="lineCount">480</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		   		if( $this-&gt;isEmpty( $model ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">481</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">482</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        $sql = 'SELECT';</pre></td>
</tr>
<tr>
<td class="lineCount">483</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">484</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        if( $this-&gt;isDistinct() != null )</pre></td>
</tr>
<tr>
<td class="lineCount">485</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        	$sql .= ' DISTINCT ' . $this-&gt;isDistinct();</pre></td>
</tr>
<tr>
<td class="lineCount">486</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        else</pre></td>
</tr>
<tr>
<td class="lineCount">487</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        		$sql .= ($this-&gt;getMaxResults() ? ' TOP ' . $this-&gt;getMaxResults() . ' *' : '');</pre></td>
</tr>
<tr>
<td class="lineCount">488</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">489</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        $sql .= ' FROM ' . $table-&gt;getName();</pre></td>
</tr>
<tr>
<td class="lineCount">490</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">491</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        $order = $this-&gt;getOrderBy();</pre></td>
</tr>
<tr>
<td class="lineCount">492</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        $offset = $this-&gt;getOffset();</pre></td>
</tr>
<tr>
<td class="lineCount">493</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   	        $groupBy = $this-&gt;getGroupBy();</pre></td>
</tr>
<tr>
<td class="lineCount">494</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">495</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    	   	         	$sql .= ($this-&gt;getRestrictions() != null) ? $this-&gt;createRestrictSQL() : '';</pre></td>
</tr>
<tr>
<td class="lineCount">496</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	$sql .= ($order != null) ? ' ORDER BY ' . $order['column'] . ' ' . $order['direction'] : '';</pre></td>
</tr>
<tr>
<td class="lineCount">497</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	$sql .= ($groupBy)? ' GROUP BY ' . $this-&gt;getGroupBy() : '';</pre></td>
</tr>
<tr>
<td class="lineCount">498</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    	   	         	$sql .= ';';</pre></td>
</tr>
<tr>
<td class="lineCount">499</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">500</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   	   	         	$this-&gt;setDistinct( null );</pre></td>
</tr>
<tr>
<td class="lineCount">501</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    	   	         	$this-&gt;setRestrictions( array() );</pre></td>
</tr>
<tr>
<td class="lineCount">502</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    	   	         	$this-&gt;setRestrictionsLogicOperator( 'AND' );</pre></td>
</tr>
<tr>
<td class="lineCount">503</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    	   	         	$this-&gt;setOrderBy( null, 'ASC' );</pre></td>
</tr>
<tr>
<td class="lineCount">504</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    	   	         	$this-&gt;setGroupBy( null );</pre></td>
</tr>
<tr>
<td class="lineCount">505</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   		 }</pre></td>
</tr>
<tr>
<td class="lineCount">506</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   		 else {</pre></td>
</tr>
<tr>
<td class="lineCount">507</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   		 		$where = '';</pre></td>
</tr>
<tr>
<td class="lineCount">508</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">509</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    	   		 		$columns = $table-&gt;getColumns();</pre></td>
</tr>
<tr>
<td class="lineCount">510</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							for( $i=0; $i&lt;count( $columns ); $i++ ) {</pre></td>
</tr>
<tr>
<td class="lineCount">511</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">512</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								 if( $columns[$i]-&gt;isLazy() ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">513</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">514</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							 	 $accessor = $this-&gt;toAccessor( $columns[$i]-&gt;getModelPropertyName() );</pre></td>
</tr>
<tr>
<td class="lineCount">515</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						     	 if( $model-&gt;$accessor() == null ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">516</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">517</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						     	 $where .= (count($values) ? ' AND ' : ' ') . $columns[$i]-&gt;getName() . '=?';</pre></td>
</tr>
<tr>
<td class="lineCount">518</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">519</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								 if( is_object( $model-&gt;$accessor() ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">520</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						     	 	 $refAccessor = $this-&gt;toAccessor( $columns[$i]-&gt;getForeignKey()-&gt;getReferencedColumnInstance()-&gt;getModelPropertyName() );</pre></td>
</tr>
<tr>
<td class="lineCount">521</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						     	 	 array_push( $values, $model-&gt;$accessor()-&gt;$refAccessor() );</pre></td>
</tr>
<tr>
<td class="lineCount">522</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						     	 }</pre></td>
</tr>
<tr>
<td class="lineCount">523</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						     	 else {</pre></td>
</tr>
<tr>
<td class="lineCount">524</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				     	 	     	 array_push( $values, $model-&gt;$accessor() );</pre></td>
</tr>
<tr>
<td class="lineCount">525</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						     	 }</pre></td>
</tr>
<tr>
<td class="lineCount">526</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						    }</pre></td>
</tr>
<tr>
<td class="lineCount">527</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						    $sql = 'SELECT * FROM ' . $table-&gt;getName() . ' WHERE' . $where;</pre></td>
</tr>
<tr>
<td class="lineCount">528</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">529</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 }</pre></td>
</tr>
<tr>
<td class="lineCount">530</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">531</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 $this-&gt;prepare( $sql );</pre></td>
</tr>
<tr>
<td class="lineCount">532</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 $this-&gt;execute( $values );</pre></td>
</tr>
<tr>
<td class="lineCount">533</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">534</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 if( !sqlsrv_has_rows( $this-&gt;stmt ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">535</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">536</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	Log::debug( 'MSSQLDialect::find Empty result set for model \'' . $table-&gt;getModel() . '\'.' );</pre></td>
</tr>
<tr>
<td class="lineCount">537</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	return array();</pre></td>
</tr>
<tr>
<td class="lineCount">538</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 }</pre></td>
</tr>
<tr>
<td class="lineCount">539</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">540</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				 	 $index = 0;</pre></td>
</tr>
<tr>
<td class="lineCount">541</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				 	 $models = array();</pre></td>
</tr>
<tr>
<td class="lineCount">542</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 while( $stdClass = sqlsrv_fetch_object( $this-&gt;stmt ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">543</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">544</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 		  $m = $table-&gt;getModelInstance();</pre></td>
</tr>
<tr>
<td class="lineCount">545</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  foreach( get_object_vars( $stdClass ) as $name =&gt; $value ) {</pre></td>
</tr>
<tr>
<td class="lineCount">546</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">547</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  		   if( $value == null ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">548</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">549</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  		   $modelProperty = $this-&gt;getPropertyNameForColumn( $table, $name );</pre></td>
</tr>
<tr>
<td class="lineCount">550</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">551</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  		   if( is_object( $value ) )</pre></td>
</tr>
<tr>
<td class="lineCount">552</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  		   	   $value = $this-&gt;cast( $value );</pre></td>
</tr>
<tr>
<td class="lineCount">553</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">554</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							 	   	   // Create foreign model instances from foreign values</pre></td>
</tr>
<tr>
<td class="lineCount">555</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		   foreach( $table-&gt;getColumns() as $column ) {</pre></td>
</tr>
<tr>
<td class="lineCount">556</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">557</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		   			if( $column-&gt;getName() != $name ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">558</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		   		    if( $column-&gt;isLazy() ) continue;</pre></td>
</tr>
<tr>
<td class="lineCount">559</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">560</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		    if( $column-&gt;isForeignKey() &amp;&amp; $column-&gt;getName() == $name ) {</pre></td>
</tr>
<tr>
<td class="lineCount">561</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">562</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    $foreignModel = $column-&gt;getForeignKey()-&gt;getReferencedTableInstance()-&gt;getModel();</pre></td>
</tr>
<tr>
<td class="lineCount">563</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    $foreignInstance = new $foreignModel();</pre></td>
</tr>
<tr>
<td class="lineCount">564</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">565</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    $foreignMutator = $this-&gt;toMutator( $column-&gt;getForeignKey()-&gt;getReferencedColumnInstance()-&gt;getModelPropertyName() );</pre></td>
</tr>
<tr>
<td class="lineCount">566</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    $foreignInstance-&gt;$foreignMutator( $value );</pre></td>
</tr>
<tr>
<td class="lineCount">567</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">568</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    $persisted = $this-&gt;find( $foreignInstance );</pre></td>
</tr>
<tr>
<td class="lineCount">569</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">570</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    // php namespace support - remove \ character from fully qualified paths</pre></td>
</tr>
<tr>
<td class="lineCount">571</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							 	 		  		   	$foreignModelPieces = explode( '\\', $foreignModel );</pre></td>
</tr>
<tr>
<td class="lineCount">572</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							 	 		  		   	$foreignClassName = array_pop( $foreignModelPieces );</pre></td>
</tr>
<tr>
<td class="lineCount">573</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">574</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    $instanceMutator = $this-&gt;toMutator( $foreignModel );</pre></td>
</tr>
<tr>
<td class="lineCount">575</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   	    $m-&gt;$instanceMutator( $persisted[0] );</pre></td>
</tr>
<tr>
<td class="lineCount">576</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		    }</pre></td>
</tr>
<tr>
<td class="lineCount">577</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		    else {</pre></td>
</tr>
<tr>
<td class="lineCount">578</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">579</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		   		$mutator = $this-&gt;toMutator( $modelProperty );</pre></td>
</tr>
<tr>
<td class="lineCount">580</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	   		  				$m-&gt;$mutator( $value );</pre></td>
</tr>
<tr>
<td class="lineCount">581</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		  		    }</pre></td>
</tr>
<tr>
<td class="lineCount">582</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						 	 		   }</pre></td>
</tr>
<tr>
<td class="lineCount">583</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  }</pre></td>
</tr>
<tr>
<td class="lineCount">584</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">585</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  array_push( $models, $m );</pre></td>
</tr>
<tr>
<td class="lineCount">586</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  $index++;</pre></td>
</tr>
<tr>
<td class="lineCount">587</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					 	   	  if( $index == $this-&gt;getMaxResults() )  break;</pre></td>
</tr>
<tr>
<td class="lineCount">588</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				     }</pre></td>
</tr>
<tr>
<td class="lineCount">589</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">590</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				     return $models;</pre></td>
</tr>
<tr>
<td class="lineCount">591</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 }</pre></td>
</tr>
<tr>
<td class="lineCount">592</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 catch( Exception $e ) {</pre></td>
</tr>
<tr>
<td class="lineCount">593</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">594</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 		throw new ORMException( $e-&gt;getMessage(), $e-&gt;getCode() );</pre></td>
</tr>
<tr>
<td class="lineCount">595</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 }</pre></td>
</tr>
<tr>
<td class="lineCount">596</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">597</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">598</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">599</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">600</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/AgilePHP/orm/BaseDialect#close()</pre></td>
</tr>
<tr>
<td class="lineCount">601</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">602</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function close() {</pre></td>
</tr>
<tr>
<td class="lineCount">603</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">604</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 if( $this-&gt;conn )</pre></td>
</tr>
<tr>
<td class="lineCount">605</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 	sqlsrv_close( $this-&gt;conn );</pre></td>
</tr>
<tr>
<td class="lineCount">606</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">607</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">608</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">609</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * (non-PHPdoc)</pre></td>
</tr>
<tr>
<td class="lineCount">610</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @see src/orm/dialect/SQLDialect#reverseEngineer()</pre></td>
</tr>
<tr>
<td class="lineCount">611</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">612</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function reverseEngineer() {</pre></td>
</tr>
<tr>
<td class="lineCount">613</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">614</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $lengthables = array( 'binary', 'char', 'decimal', 'nchar', 'numeric', 'nvarchar', 'varbinary', 'varchar' );</pre></td>
</tr>
<tr>
<td class="lineCount">615</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">616</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $Database = new Database();</pre></td>
</tr>
<tr>
<td class="lineCount">617</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $Database-&gt;setName( $this-&gt;database-&gt;getName() );</pre></td>
</tr>
<tr>
<td class="lineCount">618</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $Database-&gt;setType( $this-&gt;database-&gt;getType() );</pre></td>
</tr>
<tr>
<td class="lineCount">619</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $Database-&gt;setHostname( $this-&gt;database-&gt;getHostname() );</pre></td>
</tr>
<tr>
<td class="lineCount">620</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $Database-&gt;setUsername( $this-&gt;database-&gt;getUsername() );</pre></td>
</tr>
<tr>
<td class="lineCount">621</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $Database-&gt;setPassword( $this-&gt;database-&gt;getPassword() );</pre></td>
</tr>
<tr>
<td class="lineCount">622</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">623</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $stmt = $this-&gt;prepare( 'select * from information_schema.tables;' );</pre></td>
</tr>
<tr>
<td class="lineCount">624</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $this-&gt;execute();</pre></td>
</tr>
<tr>
<td class="lineCount">625</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $tables = array();</pre></td>
</tr>
<tr>
<td class="lineCount">626</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 while( $stdClass = sqlsrv_fetch_object( $this-&gt;stmt ) )</pre></td>
</tr>
<tr>
<td class="lineCount">627</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 	array_push( $tables, $stdClass );</pre></td>
</tr>
<tr>
<td class="lineCount">628</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">629</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $stmt2 = $this-&gt;query( 'SELECT</pre></td>
</tr>
<tr>
<td class="lineCount">630</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    FK_Table  = FK.TABLE_NAME,</pre></td>
</tr>
<tr>
<td class="lineCount">631</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    FK_Column = CU.COLUMN_NAME,</pre></td>
</tr>
<tr>
<td class="lineCount">632</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    PK_Table  = PK.TABLE_NAME,</pre></td>
</tr>
<tr>
<td class="lineCount">633</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    PK_Column = PT.COLUMN_NAME,</pre></td>
</tr>
<tr>
<td class="lineCount">634</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    Constraint_Name = C.CONSTRAINT_NAME</pre></td>
</tr>
<tr>
<td class="lineCount">635</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							FROM</pre></td>
</tr>
<tr>
<td class="lineCount">636</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS C</pre></td>
</tr>
<tr>
<td class="lineCount">637</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INNER JOIN</pre></td>
</tr>
<tr>
<td class="lineCount">638</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INFORMATION_SCHEMA.TABLE_CONSTRAINTS FK</pre></td>
</tr>
<tr>
<td class="lineCount">639</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							        ON C.CONSTRAINT_NAME = FK.CONSTRAINT_NAME</pre></td>
</tr>
<tr>
<td class="lineCount">640</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INNER JOIN</pre></td>
</tr>
<tr>
<td class="lineCount">641</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INFORMATION_SCHEMA.TABLE_CONSTRAINTS PK</pre></td>
</tr>
<tr>
<td class="lineCount">642</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							        ON C.UNIQUE_CONSTRAINT_NAME = PK.CONSTRAINT_NAME</pre></td>
</tr>
<tr>
<td class="lineCount">643</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INNER JOIN</pre></td>
</tr>
<tr>
<td class="lineCount">644</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INFORMATION_SCHEMA.KEY_COLUMN_USAGE CU</pre></td>
</tr>
<tr>
<td class="lineCount">645</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							        ON C.CONSTRAINT_NAME = CU.CONSTRAINT_NAME</pre></td>
</tr>
<tr>
<td class="lineCount">646</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    INNER JOIN</pre></td>
</tr>
<tr>
<td class="lineCount">647</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    (</pre></td>
</tr>
<tr>
<td class="lineCount">648</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							        SELECT</pre></td>
</tr>
<tr>
<td class="lineCount">649</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							            i1.TABLE_NAME, i2.COLUMN_NAME</pre></td>
</tr>
<tr>
<td class="lineCount">650</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							        FROM</pre></td>
</tr>
<tr>
<td class="lineCount">651</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							            INFORMATION_SCHEMA.TABLE_CONSTRAINTS i1</pre></td>
</tr>
<tr>
<td class="lineCount">652</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							            INNER JOIN</pre></td>
</tr>
<tr>
<td class="lineCount">653</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							            INFORMATION_SCHEMA.KEY_COLUMN_USAGE i2</pre></td>
</tr>
<tr>
<td class="lineCount">654</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							            ON i1.CONSTRAINT_NAME = i2.CONSTRAINT_NAME</pre></td>
</tr>
<tr>
<td class="lineCount">655</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							            WHERE i1.CONSTRAINT_TYPE = \'PRIMARY KEY\'</pre></td>
</tr>
<tr>
<td class="lineCount">656</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    ) PT</pre></td>
</tr>
<tr>
<td class="lineCount">657</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							    ON PT.TABLE_NAME = PK.TABLE_NAME' );</pre></td>
</tr>
<tr>
<td class="lineCount">658</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">659</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $foreignKeys = array();</pre></td>
</tr>
<tr>
<td class="lineCount">660</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 while( $stdClass = sqlsrv_fetch_object( $stmt2 ) )</pre></td>
</tr>
<tr>
<td class="lineCount">661</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 	array_push( $foreignKeys, $stdClass );</pre></td>
</tr>
<tr>
<td class="lineCount">662</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">663</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 foreach( $tables as $table ) {</pre></td>
</tr>
<tr>
<td class="lineCount">664</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">665</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 		// ignore system tables</pre></td>
</tr>
<tr>
<td class="lineCount">666</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				 	if( substr( $table-&gt;TABLE_NAME, 0, 3 ) == 'sys' || $table-&gt;TABLE_NAME == 'dtproperties' )</pre></td>
</tr>
<tr>
<td class="lineCount">667</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				 	 	continue;</pre></td>
</tr>
<tr>
<td class="lineCount">668</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">669</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 		$stmt3 = $this-&gt;query( 'SELECT [name]</pre></td>
</tr>
<tr>
<td class="lineCount">670</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									 FROM syscolumns</pre></td>
</tr>
<tr>
<td class="lineCount">671</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									 WHERE [id] IN (SELECT [id]</pre></td>
</tr>
<tr>
<td class="lineCount">672</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									                  FROM sysobjects</pre></td>
</tr>
<tr>
<td class="lineCount">673</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									                 WHERE [name] = \'' . $table-&gt;TABLE_NAME . '\' )</pre></td>
</tr>
<tr>
<td class="lineCount">674</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									   AND colid IN (SELECT SIK.colid</pre></td>
</tr>
<tr>
<td class="lineCount">675</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									                   FROM sysindexkeys SIK</pre></td>
</tr>
<tr>
<td class="lineCount">676</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									                   JOIN sysobjects SO ON SIK.[id] = SO.[id]</pre></td>
</tr>
<tr>
<td class="lineCount">677</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									                  WHERE SIK.indid = 1</pre></td>
</tr>
<tr>
<td class="lineCount">678</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									                    AND SO.[name] = \'' . $table-&gt;TABLE_NAME . '\')' );</pre></td>
</tr>
<tr>
<td class="lineCount">679</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">680</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">681</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					$primaryKeys = array();</pre></td>
</tr>
<tr>
<td class="lineCount">682</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">683</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					if( $stmt3 ) {</pre></td>
</tr>
<tr>
<td class="lineCount">684</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">685</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						while( $stdClass = sqlsrv_fetch_object( $stmt3 ) )</pre></td>
</tr>
<tr>
<td class="lineCount">686</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							array_push( $primaryKeys, $stdClass );</pre></td>
</tr>
<tr>
<td class="lineCount">687</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					}</pre></td>
</tr>
<tr>
<td class="lineCount">688</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">689</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 		$Table = new Table();</pre></td>
</tr>
<tr>
<td class="lineCount">690</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 		$Table-&gt;setName( $table-&gt;TABLE_NAME );</pre></td>
</tr>
<tr>
<td class="lineCount">691</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 		$Table-&gt;setModel( ucfirst( $table-&gt;TABLE_NAME ) );</pre></td>
</tr>
<tr>
<td class="lineCount">692</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">693</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 		$this-&gt;prepare( 'exec sp_columns ' . $table-&gt;TABLE_NAME );</pre></td>
</tr>
<tr>
<td class="lineCount">694</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			  		$this-&gt;execute();</pre></td>
</tr>
<tr>
<td class="lineCount">695</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					$columns = array();</pre></td>
</tr>
<tr>
<td class="lineCount">696</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					while( $stdClass = sqlsrv_fetch_object( $this-&gt;stmt ) )</pre></td>
</tr>
<tr>
<td class="lineCount">697</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						array_push( $columns, $stdClass );</pre></td>
</tr>
<tr>
<td class="lineCount">698</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">699</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					foreach( $columns as $column ) {</pre></td>
</tr>
<tr>
<td class="lineCount">700</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">701</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							$type = preg_match_all( '/^(.*)\\s+(identity).*$/i', $column-&gt;TYPE_NAME, $matches );</pre></td>
</tr>
<tr>
<td class="lineCount">702</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							$identity = null;</pre></td>
</tr>
<tr>
<td class="lineCount">703</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">704</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							if( count( $matches ) == 3 &amp;&amp; !empty( $matches[1] ) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">705</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">706</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								$type = $matches[1][0];</pre></td>
</tr>
<tr>
<td class="lineCount">707</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	      	      		   		$identity = $matches[2][0];</pre></td>
</tr>
<tr>
<td class="lineCount">708</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							}</pre></td>
</tr>
<tr>
<td class="lineCount">709</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							else {</pre></td>
</tr>
<tr>
<td class="lineCount">710</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">711</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								$type = $column-&gt;TYPE_NAME;</pre></td>
</tr>
<tr>
<td class="lineCount">712</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							}</pre></td>
</tr>
<tr>
<td class="lineCount">713</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">714</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							$Column = new Column( null, $table-&gt;TABLE_NAME );</pre></td>
</tr>
<tr>
<td class="lineCount">715</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							$Column-&gt;setName( $column-&gt;COLUMN_NAME );</pre></td>
</tr>
<tr>
<td class="lineCount">716</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							$Column-&gt;setType( $type );</pre></td>
</tr>
<tr>
<td class="lineCount">717</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">718</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							if( in_array( $column-&gt;TYPE_NAME, $lengthables ) )</pre></td>
</tr>
<tr>
<td class="lineCount">719</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								$Column-&gt;setLength( ($column-&gt;LENGTH == 2147483647) ? 8000 : $column-&gt;LENGTH );</pre></td>
</tr>
<tr>
<td class="lineCount">720</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">721</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							$Column-&gt;setRequired( ($column-&gt;IS_NULLABLE == 'YES') ? true : false );</pre></td>
</tr>
<tr>
<td class="lineCount">722</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">723</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							if( $identity )</pre></td>
</tr>
<tr>
<td class="lineCount">724</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								$Column-&gt;setAutoIncrement( true );</pre></td>
</tr>
<tr>
<td class="lineCount">725</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">726</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							foreach( $primaryKeys as $pkey ) {</pre></td>
</tr>
<tr>
<td class="lineCount">727</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">728</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								if( $column-&gt;COLUMN_NAME == $pkey-&gt;name )</pre></td>
</tr>
<tr>
<td class="lineCount">729</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									$Column-&gt;setPrimaryKey( true );</pre></td>
</tr>
<tr>
<td class="lineCount">730</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							}</pre></td>
</tr>
<tr>
<td class="lineCount">731</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">732</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							foreach( $foreignKeys as $fkey ) {</pre></td>
</tr>
<tr>
<td class="lineCount">733</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">734</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">								if( $fkey-&gt;FK_Table == $table-&gt;TABLE_NAME &amp;&amp;</pre></td>
</tr>
<tr>
<td class="lineCount">735</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									$fkey-&gt;FK_Column == $column-&gt;COLUMN_NAME ) {</pre></td>
</tr>
<tr>
<td class="lineCount">736</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">737</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey = new ForeignKey( null, $fkey-&gt;FK_Table, $fkey-&gt;FK_Column );</pre></td>
</tr>
<tr>
<td class="lineCount">738</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey-&gt;setName( $fkey-&gt;Constraint_Name );</pre></td>
</tr>
<tr>
<td class="lineCount">739</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey-&gt;setType( 'one-to-many' );</pre></td>
</tr>
<tr>
<td class="lineCount">740</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey-&gt;setReferencedTable( $fkey-&gt;PK_Table );</pre></td>
</tr>
<tr>
<td class="lineCount">741</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey-&gt;setReferencedColumn( $fkey-&gt;PK_Column );</pre></td>
</tr>
<tr>
<td class="lineCount">742</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey-&gt;setReferencedController( ucfirst( $fkey-&gt;FK_Table ) . 'Controller' );</pre></td>
</tr>
<tr>
<td class="lineCount">743</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey-&gt;setOnDelete( ($Column-&gt;isRequired()) ? 'CASCADE' : 'SET_NULL' );</pre></td>
</tr>
<tr>
<td class="lineCount">744</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$ForeignKey-&gt;setOnUpdate( 'CASCADE' );</pre></td>
</tr>
<tr>
<td class="lineCount">745</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">746</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">										$Column-&gt;setForeignKey( $ForeignKey );</pre></td>
</tr>
<tr>
<td class="lineCount">747</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">									}</pre></td>
</tr>
<tr>
<td class="lineCount">748</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							}</pre></td>
</tr>
<tr>
<td class="lineCount">749</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">750</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">							$Table-&gt;addColumn( $Column );</pre></td>
</tr>
<tr>
<td class="lineCount">751</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					}</pre></td>
</tr>
<tr>
<td class="lineCount">752</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">753</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					$Database-&gt;addTable( $Table );</pre></td>
</tr>
<tr>
<td class="lineCount">754</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 }</pre></td>
</tr>
<tr>
<td class="lineCount">755</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">756</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 // sp_stored_procedures</pre></td>
</tr>
<tr>
<td class="lineCount">757</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">758</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 return $Database;</pre></td>
</tr>
<tr>
<td class="lineCount">759</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">760</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">761</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">762</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * Returns the total number of records in the specified model.</pre></td>
</tr>
<tr>
<td class="lineCount">763</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   *</pre></td>
</tr>
<tr>
<td class="lineCount">764</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @param Object $model The domain object to get the count for.</pre></td>
</tr>
<tr>
<td class="lineCount">765</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @return Integer The total number of records in the table.</pre></td>
</tr>
<tr>
<td class="lineCount">766</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">767</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  public function count( $model ) {</pre></td>
</tr>
<tr>
<td class="lineCount">768</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">769</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		 $sql = 'SELECT count(*) as count FROM ' . $this-&gt;getTableByModel( $model )-&gt;getName();</pre></td>
</tr>
<tr>
<td class="lineCount">770</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $sql .= ($this-&gt;createRestrictSQL() == null) ? '' : $this-&gt;createRestrictSQL();</pre></td>
</tr>
<tr>
<td class="lineCount">771</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			 $sql .= ';';</pre></td>
</tr>
<tr>
<td class="lineCount">772</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">773</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	     	 $this-&gt;prepare( $sql );</pre></td>
</tr>
<tr>
<td class="lineCount">774</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	     	 $this-&gt;execute();</pre></td>
</tr>
<tr>
<td class="lineCount">775</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">  			 $result = sqlsrv_fetch_object( $this-&gt;stmt );</pre></td>
</tr>
<tr>
<td class="lineCount">776</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">777</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">  			 return ($result == null) ? 0 : $result-&gt;count;</pre></td>
</tr>
<tr>
<td class="lineCount">778</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">779</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">780</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  /**</pre></td>
</tr>
<tr>
<td class="lineCount">781</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * Provides unitlity method for casting SQL SERVER objects to PHP values.</pre></td>
</tr>
<tr>
<td class="lineCount">782</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   *</pre></td>
</tr>
<tr>
<td class="lineCount">783</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @param Object $value The SQL SERVER object to extract the PHP value from.</pre></td>
</tr>
<tr>
<td class="lineCount">784</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   * @return mixed The extracted PHP value.</pre></td>
</tr>
<tr>
<td class="lineCount">785</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	   */</pre></td>
</tr>
<tr>
<td class="lineCount">786</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  private function cast( $value ) {</pre></td>
</tr>
<tr>
<td class="lineCount">787</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">788</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		  if( $value instanceof DateTime )</pre></td>
</tr>
<tr>
<td class="lineCount">789</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		  	  if( isset( $value-&gt;date ) )</pre></td>
</tr>
<tr>
<td class="lineCount">790</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  		  	  	  return $value-&gt;date;</pre></td>
</tr>
<tr>
<td class="lineCount">791</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	  }</pre></td>
</tr>
<tr>
<td class="lineCount">792</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">}</pre></td>
</tr>
<tr>
<td class="lineCount">793</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">?&gt;</pre></td>
</tr>
</table>
<br><table width="100%">
<tr><td><hr noshade size="1"></td></tr>
<tr><td class="small">Report generated at 2010-06-24T17:36:36-04:00</td></tr>
</table>
</body>
</html>
