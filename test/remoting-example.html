<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>AgilePHP JavaScript Remoting</title>
		<script type="text/javascript" src="/test/index.php/RemotingController/getBaseJS/true"></script>
		<script type="text/javascript" src="/test/index.php/RemotingController/load/RMITest"></script>
		<script type="text/javascript" src="/test/index.php/RemotingController/load/RMITest2"></script>
		<script type="text/javascript">

			/** XMLHttpRequest AJAX request with innerHTML update on completion */
			function update() {
	
					 // Performs the AJAX request and then updates the <div id="content"></div> innerHTML with the responseText
					 new AgilePHP.XHR().updater( AgilePHP.getRequestBase() + '/AJAXController/testUpdater', 'content' );
			}

			/** XMLHttpRequest AJAX form post */
			function doFormSubmit( form ) {

				     var url = AgilePHP.getRequestBase() + '/AJAXController/formSubmit';
				     new AgilePHP.XHR().formSubmit( url, form, function formSubmitCallback( response ) {
				    		
						 AgilePHP.debug( 'formSubmitCallback' );
						 AgilePHP.debug( response );
		
						 document.getElementById( 'submit' ).disabled = false;
						 document.getElementById( 'formSubmitResponse' ).innerHTML = response.result;
					 });
				     document.getElementById( 'submit' ).disabled = true;
			}

			/** AgilePHP Remoting */
			function doVariousRMITests() {

					// Instantiate the remote PHP object and invoke a few #@RemoteMethod's
					var rmi = new RMITest('test1', 'test2', 'test3');
					    rmi.testme( 'arg1', 'arg2' );  // executed synchronous since no callback defined

					// Setting a callback tells puts the remoting component in asynchronous mode.
					rmi.setCallback( function mycallback( response ) {

						 // response has already eval'd
						 AgilePHP.debug( response );
					});
					rmi.setTest2( '1111' );
					rmi.testme2( 1, 2 ); // Access denied by #@Restrict( name = 'foo' )
					rmi.show();
					rmi.getTest2();

					// RMITest2 is kept stateful within AgilePHP SessionScope
					var rmi2 = new RMITest2();
						rmi2.setCallback( function mySecondCallback( response ) {

							 AgilePHP.debug( 'mySecondCallback' );
							 AgilePHP.debug( response );
					});
					rmi2.testme('arg3', 'arg4');
					rmi2.testme2('arg3', 'arg4');
			}
		</script>
	</head>
	<body>
		<input type="button" value="Test AgilePHP.XHR().updater" onclick="update()"/>
		<div id="content"></div>

		<form name="frmTestAjaxForm" onSubmit="doFormSubmit( this ); return false;">
			<table border="0">
				<tr>
					<td>Text</td>
					<td><input type="text" name="field1"/></td>
				</tr>
				<tr>
					<td>Password</td>
					<td><input type="password" name="field2"/></td>
				</tr>
				<tr>
					<td>Checkbox</td>
					<td>
						Item 1: <input type="checkbox" name="chk1"/>
						<br/>
						Item 2: <input type="checkbox" name="chk2"/>
						<br/>
						Item 3: <input type="checkbox" name="chk3"/>
					</td>
				</tr>
				<tr>
					<td>Radio</td>
					<td>
						Item 1: <input type="radio" name="radio1" value="choice1"/>
						<br/>
						Item 2: <input type="radio" name="radio1" value="choice2"/>
						<br/>
						Item 3: <input type="radio" name="radio1" value="choice3"/>
					</td>
				</tr>
				<tr>
					<td>Select</td>
					<td>
						<select name="selector1">
							<option value="selVal1">Item 1</option>
							<option value="selVal2">Item 2</option>
							<option value="selVal3">Item 3</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>Textarea</td>
					<td><textarea name="myTextArea"></textarea></td>
				</tr>
				<tr>
					<td><input id="submit" type="submit" name="Submit"></input></td>
				</tr>
			</table>
			<!-- 
			<input type="hidden" name="AGILEPHP_REQUEST_TOKEN" value="this_will_make_the_request_fail___remove me and watch it work!"/>
			-->
		</form>
		<div id="formSubmitResponse"></div>
		<div id="variousTests" style="padding-top: 25px;">
			<input type="button" onclick="javascript:doVariousRMITests()" value="Various Other RMI Tests"/> (watch firebug)
		</div>
	</body>
</html>